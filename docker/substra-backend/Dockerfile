FROM python:3.6

ARG USER_ID=1001
ARG GROUP_ID=1001

RUN mkdir -p /usr/src/app && chown -R ${USER_ID}:${GROUP_ID} /usr/src/app
WORKDIR /usr/src/app

COPY ./backend/requirements.txt /usr/src/app/.
RUN chown -R ${USER_ID}:${GROUP_ID} /usr/src/app

RUN pip3 install -r requirements.txt

COPY ./backend/manage.py /usr/src/app/manage.py
COPY ./backend/libs /usr/src/app/libs
COPY ./backend/substrapp /usr/src/app/substrapp
COPY ./backend/events /usr/src/app/events
COPY ./backend/backend /usr/src/app/backend
COPY ./backend/node /usr/src/app/node
COPY ./backend/node-register /usr/src/app/node-register
COPY ./backend/users /usr/src/app/users

RUN chown -R ${USER_ID}:${GROUP_ID} /usr/src/app

RUN apt-get update
RUN apt-get install -y net-tools git curl golang tcpdump
RUN apt-get install sudo
RUN useradd -u ${USER_ID} myuser
RUN echo "myuser  ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/myuser

USER ${USER_ID}:${GROUP_ID}
